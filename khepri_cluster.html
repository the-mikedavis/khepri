<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.5">
    <meta name="project" content="khepri v0.4.3">

    <title>khepri_cluster â€” khepri v0.4.3</title>
    <link rel="stylesheet" href="dist/html-erlang-C3352F33.css" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-X7YVL3G2.js"></script>
    <script src="dist/sidebar_items-FD7723E7.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-PLW5RNNI.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="overview.html">
        <img src="assets/logo.svg" alt="khepri" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="overview.html" class="sidebar-projectName" translate="no">
khepri
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.4.3
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


  <span translate="no">khepri_cluster</span> 
  <small class="app-vsn" translate="no">(khepri v0.4.3)</small>

</h1>


  <section id="moduledoc">
<p>Khepri service and cluster management API.</p><p>This module provides the public API for the service and cluster management. For convenience, some functions of this API are repeated in the <a href="khepri.html"><code>khepri</code></a> module for easier access.</p><h3 id="module-the-khepri-store-and-the-ra-cluster" class="section-heading">
  <a href="#module-the-khepri-store-and-the-ra-cluster" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">the-khepri-store-and-the-ra-cluster</p>
  </a>
  <a name="The_Khepri_store_and_the_Ra_cluster">The Khepri store and the Ra cluster</a>
</h3>
<p>A Khepri store is a Ra server inside a Ra cluster. The Khepri store and the Ra cluster share the same name in fact. The only constraint is that the name must be an atom, even though Ra accepts other Erlang types as cluster names.</p><p>By default, Khepri uses <a href="khepri.html"><code>khepri</code></a> as the store ID (and thus Ra cluster name). This default can be overridden using an argument to the <a href="#start/0"><code>start/0</code></a> functions or the <code>default_store_id</code> application environment variable.</p>Examples:<ul><li>Use the default Khepri store ID:<pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="1446976163-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">khepri</span><span class="p" data-group-id="1446976163-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="1446976163-2">(</span><span class="p" data-group-id="1446976163-2">)</span><span class="p">.</span></code></pre></li><li>Override the default store ID using an argument:<pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="2906925164-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">my_store</span><span class="p" data-group-id="2906925164-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2906925164-2">(</span><span class="s">&quot;/var/lib/khepri&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">my_store</span><span class="p" data-group-id="2906925164-2">)</span><span class="p">.</span></code></pre></li><li>Override the default store ID using an application environment variable:<pre><code class="makeup erlang" translate="no"><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">set_env</span><span class="p" data-group-id="9895437733-1">(</span><span class="w">
         </span><span class="ss">khepri</span><span class="p">,</span><span class="w"> </span><span class="ss">default_store_id</span><span class="p">,</span><span class="w"> </span><span class="ss">my_store</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9895437733-2">[</span><span class="p" data-group-id="9895437733-3">{</span><span class="ss">persistent</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9895437733-3">}</span><span class="p" data-group-id="9895437733-2">]</span><span class="p" data-group-id="9895437733-1">)</span><span class="p">,</span><span class="w">
 
  </span><span class="p" data-group-id="9895437733-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="ss">my_store</span><span class="p" data-group-id="9895437733-4">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="9895437733-5">(</span><span class="p" data-group-id="9895437733-5">)</span><span class="p">.</span></code></pre></li></ul><h3 id="module-the-data-directory-and-the-ra-system" class="section-heading">
  <a href="#module-the-data-directory-and-the-ra-system" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">the-data-directory-and-the-ra-system</p>
  </a>
  <a name="The_data_directory_and_the_Ra_system">The data directory and the Ra system</a>
</h3>
<p>A Ra server relies on a Ra system to provide various functions and to configure the directory where the data should be stored on disk.</p><p>By default, Khepri will configure its own Ra system to write data under <a href="khepri.html"><code>khepri</code></a> in the current working directory, where <code>Nodename</code> is the name of the Erlang node.</p><pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="p" data-group-id="8265591901-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">StoreId</span><span class="p" data-group-id="8265591901-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8265591901-2">(</span><span class="p" data-group-id="8265591901-2">)</span><span class="p">.</span><span class="w">
 
  </span><span class="c1">%% If the Erlang node was started without distribution (the default), the</span><span class="w">
  </span><span class="c1">%% statement above will start a Ra system called like the store (`khepri&#39;)</span><span class="w">
  </span><span class="c1">%% and will use the `khepri#nonode@nohost&#39; directory.</span></code></pre><p>The default data directory or Ra system name can be overridden using an argument to the <a href="#start/0"><code>start/0</code></a> or the <code>default_ra_system</code> application environment variable. Both a directory (string or binary) or the name of an already running Ra system are accepted.</p>Examples:<ul><li>Override the default with the name of a running Ra system using an argument:<pre><code class="makeup erlang" translate="no"><span class="p" data-group-id="9561034112-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">StoreId</span><span class="p" data-group-id="9561034112-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="9561034112-2">(</span><span class="ss">my_ra_system</span><span class="p" data-group-id="9561034112-2">)</span><span class="p">.</span></code></pre></li><li>Override the default data directory using an application environment variable:<pre><code class="makeup erlang" translate="no"><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">set_env</span><span class="p" data-group-id="4375268358-1">(</span><span class="w">
         </span><span class="ss">khepri</span><span class="p">,</span><span class="w"> </span><span class="ss">default_ra_system</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/var/lib/khepri&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4375268358-2">[</span><span class="p" data-group-id="4375268358-3">{</span><span class="ss">persistent</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="4375268358-3">}</span><span class="p" data-group-id="4375268358-2">]</span><span class="p" data-group-id="4375268358-1">)</span><span class="p">,</span><span class="w">
 
  </span><span class="p" data-group-id="4375268358-4">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">StoreId</span><span class="p" data-group-id="4375268358-4">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="4375268358-5">(</span><span class="p" data-group-id="4375268358-5">)</span><span class="p">.</span></code></pre></li></ul><p>Please refer to <a href="https://github.com/rabbitmq/ra">Ra documentation</a> to learn more about Ra systems and Ra clusters.</p><h3 id="module-managing-ra-cluster-members" class="section-heading">
  <a href="#module-managing-ra-cluster-members" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">managing-ra-cluster-members</p>
  </a>
  <a name="Managing_Ra_cluster_members">Managing Ra cluster members</a>
</h3>
<p>A Khepri/Ra cluster can be expanded by telling a node to join a remote cluster. Note that the Khepri store/Ra server to add to the cluster must run before it can join.</p><pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Start the local Khepri store.</span><span class="w">
  </span><span class="p" data-group-id="4103892820-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">StoreId</span><span class="p" data-group-id="4103892820-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="4103892820-2">(</span><span class="p" data-group-id="4103892820-2">)</span><span class="p">.</span><span class="w">
 
  </span><span class="c1">%% Join a remote cluster.</span><span class="w">
  </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_cluster</span><span class="p">:</span><span class="nf">join</span><span class="p" data-group-id="4103892820-3">(</span><span class="n">RemoteNode</span><span class="p" data-group-id="4103892820-3">)</span><span class="p">.</span></code></pre><p>To remove the local Khepri store node from the cluster, it must be reset.</p><pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Start the local Khepri store.</span><span class="w">
  </span><span class="ss">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_cluster</span><span class="p">:</span><span class="nf">reset</span><span class="p" data-group-id="2386250199-1">(</span><span class="p" data-group-id="2386250199-1">)</span><span class="p">.</span></code></pre>
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>

  <div class="summary-types summary">
    <h2>
      <a href="#types">Types</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#t:incomplete_ra_server_config/0" translate="no">incomplete_ra_server_config/0</a>

        </div>

          <div class="summary-synopsis"><p>A Ra server config map.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#t:ra_server_config_with_cluster_name/0" translate="no">ra_server_config_with_cluster_name/0</a>

        </div>

          <div class="summary-synopsis">Intermediate Ra server configuration with <code>cluster_name</code> set.</div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#t:ra_server_config_with_id_and_cn/0" translate="no">ra_server_config_with_id_and_cn/0</a>

        </div>

          <div class="summary-synopsis">Intermediate Ra server configuration with <code>id</code> and <code>cluster_name</code> set.</div>

      </div>

  </div>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#cache_leader/2" translate="no">cache_leader(StoreId, LeaderId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#cache_leader_if_changed/3" translate="no">cache_leader_if_changed(StoreId, LeaderId, NewLeaderId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#clear_cached_leader/1" translate="no">clear_cached_leader(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_cached_leader/1" translate="no">get_cached_leader(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_default_ra_system_or_data_dir/0" translate="no">get_default_ra_system_or_data_dir()</a>

        </div>

          <div class="summary-synopsis"><p>Returns the default Ra system name or data directory.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_default_store_id/0" translate="no">get_default_store_id()</a>

        </div>

          <div class="summary-synopsis"><p>Returns the default Khepri store ID.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#get_store_ids/0" translate="no">get_store_ids()</a>

        </div>

          <div class="summary-synopsis">Returns the list of running stores.</div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#join/1" translate="no">join(RemoteNode)</a>

        </div>

          <div class="summary-synopsis"><p>Adds the local running Khepri store to a remote cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#join/2" translate="no">join(RemoteNode, Timeout)</a>

        </div>

          <div class="summary-synopsis"><p>Adds the local running Khepri store to a remote cluster.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#locally_known_members/1" translate="no">locally_known_members(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#locally_known_members/2" translate="no">locally_known_members(StoreId, Timeout)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#locally_known_nodes/1" translate="no">locally_known_nodes(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#members/1" translate="no">members(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#members/2" translate="no">members(StoreId, Timeout)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#nodes/1" translate="no">nodes(StoreId)</a>

        </div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#reset/0" translate="no">reset()</a>

        </div>

          <div class="summary-synopsis">Resets the store on this Erlang node.</div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#reset/1" translate="no">reset(Timeout)</a>

        </div>

          <div class="summary-synopsis">Resets the store on this Erlang node.</div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#reset/2" translate="no">reset(StoreId, Timeout)</a>

        </div>

          <div class="summary-synopsis"><p>Resets the store on this Erlang node.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#start/0" translate="no">start()</a>

        </div>

          <div class="summary-synopsis"><p>Starts a store.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#start/1" translate="no">start(RaSystemOrDataDir)</a>

        </div>

          <div class="summary-synopsis"><p>Starts a store.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#start/2" translate="no">start(RaSystemOrDataDir, StoreIdOrRaServerConfig)</a>

        </div>

          <div class="summary-synopsis"><p>Starts a store.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#start/3" translate="no">start(RaSystemOrDataDir, StoreIdOrRaServerConfig, Timeout)</a>

        </div>

          <div class="summary-synopsis"><p>Starts a store.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#stop/0" translate="no">stop()</a>

        </div>

          <div class="summary-synopsis"><p>Stops a store.</p></div>

      </div>

      <div class="summary-row">
        <div class="summary-signature">
          <a href="#stop/1" translate="no">stop(StoreId)</a>

        </div>

          <div class="summary-synopsis">Stops a store.</div>

      </div>

  </div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Types
    </h1>
    <div class="types-list">
<section class="detail" id="t:incomplete_ra_server_config/0">

  <div class="detail-header">
    <a href="#t:incomplete_ra_server_config/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">incomplete_ra_server_config/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> incomplete_ra_server_config() :: map().</pre>

      </div>

<p>A Ra server config map.</p>This configuration map can lack the required parameters, Khepri will fill them if necessary. Important parameters for Khepri (e.g. <code>machine</code>) will be overridden anyway.
  </section>
</section>
<section class="detail" id="t:ra_server_config_with_cluster_name/0">

  <div class="detail-header">
    <a href="#t:ra_server_config_with_cluster_name/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">ra_server_config_with_cluster_name/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> ra_server_config_with_cluster_name() :: #{cluster_name := <a href="khepri.html#t:store_id/0">khepri:store_id</a>()}.</pre>

      </div>

Intermediate Ra server configuration with <code>cluster_name</code> set.
  </section>
</section>
<section class="detail" id="t:ra_server_config_with_id_and_cn/0">

  <div class="detail-header">
    <a href="#t:ra_server_config_with_id_and_cn/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">ra_server_config_with_id_and_cn/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> ra_server_config_with_id_and_cn() :: #{id := <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>(), cluster_name := <a href="khepri.html#t:store_id/0">khepri:store_id</a>()}.</pre>

      </div>

Intermediate Ra server configuration with <code>id</code> and <code>cluster_name</code> set.
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="cache_leader/2">

  <div class="detail-header">
    <a href="#cache_leader/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cache_leader(StoreId, LeaderId)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> cache_leader(StoreId, LeaderId) -> ok
                when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(), LeaderId :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="cache_leader_if_changed/3">

  <div class="detail-header">
    <a href="#cache_leader_if_changed/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cache_leader_if_changed(StoreId, LeaderId, NewLeaderId)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> cache_leader_if_changed(StoreId, LeaderId, NewLeaderId) -> ok
                           when
                               StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                               LeaderId :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>(),
                               NewLeaderId :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="clear_cached_leader/1">

  <div class="detail-header">
    <a href="#clear_cached_leader/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_cached_leader(StoreId)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_cached_leader(StoreId) -> ok when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="get_cached_leader/1">

  <div class="detail-header">
    <a href="#get_cached_leader/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_cached_leader(StoreId)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_cached_leader(StoreId) -> Ret
                     when
                         StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                         Ret :: LeaderId | undefined,
                         LeaderId :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>().</pre>

      </div>


  </section>
</section>
<section class="detail" id="get_default_ra_system_or_data_dir/0">

  <div class="detail-header">
    <a href="#get_default_ra_system_or_data_dir/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_default_ra_system_or_data_dir()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_default_ra_system_or_data_dir() -> RaSystem | DataDir
                                     when RaSystem :: atom(), DataDir :: <a href="https://www.erlang.org/doc/man/file.html#type-filename_all">file:filename_all</a>().</pre>

      </div>

<p>Returns the default Ra system name or data directory.</p><p>This is based on Khepri's <code>default_ra_system` application environment variable. The variable can be set to: &lt;ul&gt; &lt;li&gt;A directory (a string or binary) where data should be stored. A new Ra system called `khepri` will be initialized with this directory.&lt;/li&gt; &lt;li&gt;A Ra system name (an atom). In this case, the user is expected to configure and start the Ra system before starting Khepri.&lt;/li&gt; &lt;/ul&gt; If this application environment variable is unset, the default is to configure a Ra system called `khepri</code> which will write data in <code>&quot;khepri-$NODE&quot;</code> in the current working directory where <code>$NODE</code> is the Erlang node name.</p>Example of an Erlang configuration file for Khepri:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="p" data-group-id="7436488598-1">{</span><span class="ss">khepri</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7436488598-2">[</span><span class="p" data-group-id="7436488598-3">{</span><span class="ss">default_ra_system</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/var/db/khepri&quot;</span><span class="p" data-group-id="7436488598-3">}</span><span class="p" data-group-id="7436488598-2">]</span><span class="p" data-group-id="7436488598-1">}</span><span class="p">.</span></code></pre>
  </section>
</section>
<section class="detail" id="get_default_store_id/0">

  <div class="detail-header">
    <a href="#get_default_store_id/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_default_store_id()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_default_store_id() -> StoreId when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>().</pre>

      </div>

<p>Returns the default Khepri store ID.</p>This is based on Khepri's <code>default_store_id</code> application environment variable. The variable can be set to an atom. The default is <a href="khepri.html"><code>khepri</code></a>.
  </section>
</section>
<section class="detail" id="get_store_ids/0">

  <div class="detail-header">
    <a href="#get_store_ids/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_store_ids()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_store_ids() -> [StoreId] when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>().</pre>

      </div>

Returns the list of running stores.
  </section>
</section>
<section class="detail" id="join/1">

  <div class="detail-header">
    <a href="#join/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">join(RemoteNode)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> join(RemoteMember | RemoteNode) -> Ret
        when RemoteMember :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>(), RemoteNode :: node(), Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Adds the local running Khepri store to a remote cluster.</p>This function accepts the following forms:<ul><li><code>join(RemoteNode)</code>. Calling it is the same as calling <code>join(DefaultStoreId, RemoteNode)</code> where <code>DefaultStoreId</code> is returned by <a href="#get_default_store_id/0"><code>get_default_store_id/0</code></a>.</li><li><code>join(RemoteMember)</code>. Calling it is the same as calling <code>join(StoreId, RemoteNode)</code> where <code>StoreId</code> and <code>RemoteNode</code> are derived from <code>RemoteMember</code>.</li></ul><p><em>See also: </em><a href="#join/2">join/2</a>.</p>
  </section>
</section>
<section class="detail" id="join/2">

  <div class="detail-header">
    <a href="#join/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">join(RemoteNode, Timeout)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> join(RemoteMember | RemoteNode | StoreId, Timeout | RemoteNode) -> Ret
        when
            RemoteMember :: <a href="https://hexdocs.pm/ra/ra.html#t:server_id/0">ra:server_id</a>(),
            RemoteNode :: node(),
            StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
            Timeout :: timeout(),
            Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Adds the local running Khepri store to a remote cluster.</p>This function accepts the following forms:<ul><li><code>join(RemoteNode, Timeout)</code>. Calling it is the same as calling <code>join(DefaultStoreId, RemoteNode, Timeout)</code> where <code>DefaultStoreId</code> is returned by <a href="#get_default_store_id/0"><code>get_default_store_id/0</code></a>.</li><li><code>join(StoreId, RemoteNode)</code>. Calling it is the same as calling <code>join(StoreId, RemoteNode, DefaultTimeout)</code> where <code>DefaultTimeout</code> is returned by <a href="khepri_app.html#get_default_timeout/0"><code>khepri_app:get_default_timeout/0</code></a>.</li><li><code>join(RemoteMember, Timeout)</code>. Calling it is the same as calling <code>join(StoreId, RemoteNode, Timeout)</code> where <code>StoreId</code> and <code>RemoteNode</code> are derived from <code>RemoteMember</code>.</li></ul><p><em>See also: </em><a href="#join/3">join/3</a>.</p>
  </section>
</section>
<section class="detail" id="locally_known_members/1">

  <div class="detail-header">
    <a href="#locally_known_members/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">locally_known_members(StoreId)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="locally_known_members/2">

  <div class="detail-header">
    <a href="#locally_known_members/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">locally_known_members(StoreId, Timeout)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="locally_known_nodes/1">

  <div class="detail-header">
    <a href="#locally_known_nodes/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">locally_known_nodes(StoreId)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="members/1">

  <div class="detail-header">
    <a href="#members/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">members(StoreId)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="members/2">

  <div class="detail-header">
    <a href="#members/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">members(StoreId, Timeout)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="nodes/1">

  <div class="detail-header">
    <a href="#nodes/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">nodes(StoreId)</h1>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="reset/0">

  <div class="detail-header">
    <a href="#reset/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reset() -> Ret when Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

Resets the store on this Erlang node.
  </section>
</section>
<section class="detail" id="reset/1">

  <div class="detail-header">
    <a href="#reset/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset(Timeout)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reset(StoreId | Timeout) -> Ret
         when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(), Timeout :: timeout(), Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

Resets the store on this Erlang node.
  </section>
</section>
<section class="detail" id="reset/2">

  <div class="detail-header">
    <a href="#reset/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">reset(StoreId, Timeout)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> reset(StoreId, Timeout) -> Ret
         when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(), Timeout :: timeout(), Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Resets the store on this Erlang node.</p><p>It does that by force-deleting the Ra local server.</p>This function is also used to gracefully remove the local Khepri store node from a cluster.
  </section>
</section>
<section class="detail" id="start/0">

  <div class="detail-header">
    <a href="#start/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start() -> Ret when Ret :: <a href="khepri.html#t:ok/1">khepri:ok</a>(StoreId) | <a href="khepri.html#t:error/0">khepri:error</a>(), StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>().</pre>

      </div>

<p>Starts a store.</p>Calling this function is the same as calling <code>start(DefaultRaSystem)</code> where <code>DefaultRaSystem</code> is returned by <a href="#get_default_ra_system_or_data_dir/0"><code>get_default_ra_system_or_data_dir/0</code></a>.<p><em>See also: </em><a href="#start/1">start/1</a>, ra_server:ra_server_config/0.</p>
  </section>
</section>
<section class="detail" id="start/1">

  <div class="detail-header">
    <a href="#start/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start(RaSystemOrDataDir)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start(RaSystem | DataDir) -> Ret
         when
             RaSystem :: atom(),
             DataDir :: <a href="https://www.erlang.org/doc/man/file.html#type-filename_all">file:filename_all</a>(),
             Ret :: <a href="khepri.html#t:ok/1">khepri:ok</a>(StoreId) | <a href="khepri.html#t:error/0">khepri:error</a>(),
             StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>().</pre>

      </div>

<p>Starts a store.</p>Calling this function is the same as calling <code>start(RaSystemOrDataDir, DefaultStoreId)</code> where <code>DefaultStoreId</code> is returned by <a href="#get_default_store_id/0"><code>get_default_store_id/0</code></a>.<p><em>See also: </em><a href="#start/2">start/2</a>.</p>
  </section>
</section>
<section class="detail" id="start/2">

  <div class="detail-header">
    <a href="#start/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start(RaSystemOrDataDir, StoreIdOrRaServerConfig)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start(RaSystem | DataDir, StoreId | RaServerConfig) -> Ret
         when
             RaSystem :: atom(),
             DataDir :: <a href="https://www.erlang.org/doc/man/file.html#type-filename_all">file:filename_all</a>(),
             StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
             RaServerConfig :: <a href="#t:incomplete_ra_server_config/0">incomplete_ra_server_config</a>(),
             Ret :: <a href="khepri.html#t:ok/1">khepri:ok</a>(StoreId) | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Starts a store.</p>Calling this function is the same as calling <code>start(RaSystemOrDataDir, StoreIdOrRaServerConfig, DefaultTimeout)</code> where <code>DefaultTimeout</code> is returned by <a href="khepri_app.html#get_default_timeout/0"><code>khepri_app:get_default_timeout/0</code></a>.<p><em>See also: </em><a href="#start/3">start/3</a>.</p>
  </section>
</section>
<section class="detail" id="start/3">

  <div class="detail-header">
    <a href="#start/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">start(RaSystemOrDataDir, StoreIdOrRaServerConfig, Timeout)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> start(RaSystem | DataDir, StoreId | RaServerConfig, Timeout) -> Ret
         when
             RaSystem :: atom(),
             DataDir :: <a href="https://www.erlang.org/doc/man/file.html#type-filename_all">file:filename_all</a>(),
             StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
             RaServerConfig :: <a href="#t:incomplete_ra_server_config/0">incomplete_ra_server_config</a>(),
             Timeout :: timeout(),
             Ret :: <a href="khepri.html#t:ok/1">khepri:ok</a>(StoreId) | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Starts a store.</p><p>It accepts either a Ra system name (atom) or a data directory (string or binary) as its first argument. If a Ra system name is given, that Ra system must be running when this function is called. If a data directory is given, a new Ra system will be started, using this directory. The directory will be created automatically if it doesn't exist. The Ra system will use the same name as the Khepri store.</p><p>It accepts a Khepri store ID or a Ra server configuration as its second argument. If a store ID is given, a Ra server configuration will be created based on it. If a Ra server configuration is given, the name of the Khepri store will be derived from it.</p><p>If this is a new store, the Ra server is started and an election is triggered so that it becomes its own leader and is ready to process commands and queries.</p>If the store was started in the past and stopped, it will be restarted. In this case, <code>RaServerConfig</code> will be ignored. Ra will take care of the eletion automatically.
  </section>
</section>
<section class="detail" id="stop/0">

  <div class="detail-header">
    <a href="#stop/0" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">stop()</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop() -> Ret when Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

<p>Stops a store.</p>Calling this function is the same as calling <code>stop(DefaultStoreId)</code> where <code>DefaultStoreId</code> is returned by <a href="#get_default_store_id/0"><code>get_default_store_id/0</code></a>.<p><em>See also: </em><a href="#stop/1">stop/1</a>.</p>
  </section>
</section>
<section class="detail" id="stop/1">

  <div class="detail-header">
    <a href="#stop/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">stop(StoreId)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> stop(StoreId) -> Ret when StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(), Ret :: ok | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

Stops a store.
  </section>
</section>

    </div>
  </section>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/khepri/0.4.3" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/khepri/0.4.3" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/khepri/0.4.3/show/src/khepri_cluster.erl">(current file)</a>

            </span>

            <button class="a-main line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.5) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
