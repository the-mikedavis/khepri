<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.1">
    <meta name="project" content="khepri v0.6.0">

    <title>khepri_adv â€” khepri v0.6.0</title>
    <link rel="stylesheet" href="dist/html-erlang-GK6YAAQS.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-IV5W3OL2.js"></script>
    <script src="dist/sidebar_items-40A8A753.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-XN2TSG4M.js"></script>


  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="overview.html">
        <img src="assets/logo.svg" alt="khepri" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="overview.html" class="sidebar-projectName" translate="no">
khepri
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.6.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


  <span translate="no">khepri_adv</span> 
  <small class="app-vsn" translate="no">(khepri v0.6.0)</small>

</h1>


  <section id="moduledoc">
<p>Khepri database advanced API.</p><p>This module exposes variants of the functions in <a href="khepri.html"><code>khepri</code></a> which return more detailed return values for advanced use cases. Here are some examples of what can be achieved with this module:</p><ul><li>Distinguish a tree node with the <code>undefined</code> atom as its payload, from a tree node with no payload, from a non-existing tree node.</li><li>Know the payload version after a call to the functions based on <a href="#put/4"><code>put/4</code></a> which can be useful to perform transactional operations without using <a href="khepri.html#transaction/4"><code>khepri:transaction/4</code></a>.</li></ul>Functions provided by <a href="khepri.html"><code>khepri</code></a> are implemented on top of this module and simplify the return value for the more common use cases.
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:many_results/0" translate="no">many_results/0</a>

      </div>

        <div class="summary-synopsis">Return value of a query or synchronous command targeting many tree nodes.</div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:node_props_map/0" translate="no">node_props_map/0</a>

      </div>

        <div class="summary-synopsis">Structure used to return a map of nodes and their associated properties, payload and child nodes.</div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:single_result/0" translate="no">single_result/0</a>

      </div>

        <div class="summary-synopsis">Return value of a query or synchronous command targeting one specific tree node.</div>

    </div>

</div>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_many_payloads/1" translate="no">clear_many_payloads(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_many_payloads/2" translate="no">clear_many_payloads(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_many_payloads/3" translate="no">clear_many_payloads(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_payload/1" translate="no">clear_payload(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_payload/2" translate="no">clear_payload(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#clear_payload/3" translate="no">clear_payload(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#compare_and_swap/3" translate="no">compare_and_swap(PathPattern, DataPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#compare_and_swap/4" translate="no">compare_and_swap(StoreId, PathPattern, DataPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#compare_and_swap/5" translate="no">compare_and_swap(StoreId, PathPattern, DataPattern, Data, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create/2" translate="no">create(PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a tree node with the given payload.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create/3" translate="no">create(StoreId, PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a tree node with the given payload.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#create/4" translate="no">create(StoreId, PathPattern, Data, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Creates a tree node with the given payload.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete/1" translate="no">delete(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete/2" translate="no">delete(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete/3" translate="no">delete(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_many/1" translate="no">delete_many(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_many/2" translate="no">delete_many(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#delete_many/3" translate="no">delete_many(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Deletes all tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get/1" translate="no">get(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get/2" translate="no">get(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get/3" translate="no">get(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_many/1" translate="no">get_many(PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_many/2" translate="no">get_many(StoreId, PathPattern)</a>

      </div>

        <div class="summary-synopsis"><p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_many/3" translate="no">get_many(StoreId, PathPattern, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put/2" translate="no">put(PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put/3" translate="no">put(StoreId, PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put/4" translate="no">put(StoreId, PathPattern, Data, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of the tree node pointed to by the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_many/2" translate="no">put_many(PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_many/3" translate="no">put_many(StoreId, PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#put_many/4" translate="no">put_many(StoreId, PathPattern, Data, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the payload of all the tree nodes matching the given path pattern.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update/2" translate="no">update(PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update/3" translate="no">update(StoreId, PathPattern, Data)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update/4" translate="no">update(StoreId, PathPattern, Data, Options)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing tree node with the given payload.</p></div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Types
    </h1>
    <div class="types-list">
<section class="detail" id="t:many_results/0">

  <div class="detail-header">
    <a href="#t:many_results/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">many_results/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> many_results() :: <a href="khepri_machine.html#t:common_ret/0">khepri_machine:common_ret</a>().</pre>

      </div>

Return value of a query or synchronous command targeting many tree nodes.
  </section>
</section>
<section class="detail" id="t:node_props_map/0">

  <div class="detail-header">
    <a href="#t:node_props_map/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">node_props_map/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> node_props_map() :: #{<a href="khepri_path.html#t:native_path/0">khepri_path:native_path</a>() => <a href="khepri.html#t:node_props/0">khepri:node_props</a>()}.</pre>

      </div>

Structure used to return a map of nodes and their associated properties, payload and child nodes.
  </section>
</section>
<section class="detail" id="t:single_result/0">

  <div class="detail-header">
    <a href="#t:single_result/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">single_result/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> single_result() :: <a href="khepri.html#t:ok/1">khepri:ok</a>(<a href="khepri.html#t:node_props/0">khepri:node_props</a>() | #{}) | <a href="khepri.html#t:error/0">khepri:error</a>().</pre>

      </div>

Return value of a query or synchronous command targeting one specific tree node.
  </section>
</section>

    </div>
  </section>

  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Functions
    </h1>
    <div class="functions-list">
<section class="detail" id="clear_many_payloads/1">

  <div class="detail-header">
    <a href="#clear_many_payloads/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_many_payloads(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_many_payloads(PathPattern) -> Ret
                       when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Deletes the payload of all tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>clear_many_payloads(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#clear_many_payloads/2">clear_many_payloads/2</a>, <a href="#clear_many_payloads/3">clear_many_payloads/3</a>.</p>
  </section>
</section>
<section class="detail" id="clear_many_payloads/2">

  <div class="detail-header">
    <a href="#clear_many_payloads/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_many_payloads(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_many_payloads(StoreId, PathPattern) -> Ret
                       when
                           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                           Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Deletes the payload of all tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>clear_many_payloads(StoreId, PathPattern, #{})</code>.<p><em>See also: </em><a href="#clear_many_payloads/3">clear_many_payloads/3</a>.</p>
  </section>
</section>
<section class="detail" id="clear_many_payloads/3">

  <div class="detail-header">
    <a href="#clear_many_payloads/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_many_payloads(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_many_payloads(StoreId, PathPattern, Options) -> Ret
                       when
                           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                           Options ::
                               <a href="khepri.html#t:command_options/0">khepri:command_options</a>() |
                               <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() |
                               <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
                           Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Deletes the payload of all tree nodes matching the given path pattern.</p>In other words, the payload is set to <a href="khepri_payload.html#t:no_payload/0"><code>khepri_payload:no_payload()</code></a>. Otherwise, the behavior is that of <a href="#put/4"><code>put/4</code></a>.<p><em>See also: </em><a href="#delete_many/3">delete_many/3</a>, <a href="#put/4">put/4</a>, <a href="khepri.html#clear_many_payloads/3">khepri:clear_many_payloads/3</a>.</p>
  </section>
</section>
<section class="detail" id="clear_payload/1">

  <div class="detail-header">
    <a href="#clear_payload/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_payload(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_payload(PathPattern) -> Ret
                 when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Deletes the payload of the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>clear_payload(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#clear_payload/2">clear_payload/2</a>, <a href="#clear_payload/3">clear_payload/3</a>.</p>
  </section>
</section>
<section class="detail" id="clear_payload/2">

  <div class="detail-header">
    <a href="#clear_payload/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_payload(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_payload(StoreId, PathPattern) -> Ret
                 when
                     StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                     PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                     Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Deletes the payload of the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>clear_payload(StoreId, PathPattern, #{})</code>.<p><em>See also: </em><a href="#clear_payload/3">clear_payload/3</a>.</p>
  </section>
</section>
<section class="detail" id="clear_payload/3">

  <div class="detail-header">
    <a href="#clear_payload/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">clear_payload(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> clear_payload(StoreId, PathPattern, Options) -> Ret
                 when
                     StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                     PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                     Options ::
                         <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() | <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
                     Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Deletes the payload of the tree node pointed to by the given path pattern.</p>In other words, the payload is set to <a href="khepri_payload.html#t:no_payload/0"><code>khepri_payload:no_payload()</code></a>. Otherwise, the behavior is that of <a href="#update/4"><code>update/4</code></a>.<p><em>See also: </em><a href="#update/4">update/4</a>, <a href="khepri.html#clear_payload/3">khepri:clear_payload/3</a>.</p>
  </section>
</section>
<section class="detail" id="compare_and_swap/3">

  <div class="detail-header">
    <a href="#compare_and_swap/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">compare_and_swap(PathPattern, DataPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> compare_and_swap(PathPattern, DataPattern, Data) -> Ret
                    when
                        PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                        DataPattern :: <a href="https://www.erlang.org/doc/man/ets.html#type-match_pattern">ets:match_pattern</a>(),
                        Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                        Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p>Calling this function is the same as calling <code>compare_and_swap(StoreId, PathPattern, DataPattern, Data)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#compare_and_swap/4">compare_and_swap/4</a>, <a href="#compare_and_swap/5">compare_and_swap/5</a>.</p>
  </section>
</section>
<section class="detail" id="compare_and_swap/4">

  <div class="detail-header">
    <a href="#compare_and_swap/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">compare_and_swap(StoreId, PathPattern, DataPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> compare_and_swap(StoreId, PathPattern, DataPattern, Data) -> Ret
                    when
                        StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                        PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                        DataPattern :: <a href="https://www.erlang.org/doc/man/ets.html#type-match_pattern">ets:match_pattern</a>(),
                        Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                        Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p>Calling this function is the same as calling <code>compare_and_swap(StoreId, PathPattern, DataPattern, Data, #{})</code>.<p><em>See also: </em><a href="#compare_and_swap/5">compare_and_swap/5</a>.</p>
  </section>
</section>
<section class="detail" id="compare_and_swap/5">

  <div class="detail-header">
    <a href="#compare_and_swap/5" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">compare_and_swap(StoreId, PathPattern, DataPattern, Data, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> compare_and_swap(StoreId, PathPattern, DataPattern, Data, Options) -> Ret
                    when
                        StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                        PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                        DataPattern :: <a href="https://www.erlang.org/doc/man/ets.html#type-match_pattern">ets:match_pattern</a>(),
                        Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                        Options ::
                            <a href="khepri.html#t:command_options/0">khepri:command_options</a>() |
                            <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() |
                            <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
                        Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload only if its data matches the given pattern.</p><p>The behavior is the same as <a href="#put/4"><code>put/4</code></a> except that if the tree node already exists, an <code>{error, ?khepri_error(mismatching_node, Info)}</code> tuple is returned.</p>Internally, the <code>PathPattern</code> is modified to include an <code>#if_data_matches{pattern = DataPattern}</code> condition on its last component.<p><em>See also: </em><a href="#put/4">put/4</a>, <a href="khepri.html#compare_and_swap/5">khepri:compare_and_swap/5</a>.</p>
  </section>
</section>
<section class="detail" id="create/2">

  <div class="detail-header">
    <a href="#create/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create(PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> create(PathPattern, Data) -> Ret
          when
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Creates a tree node with the given payload.</p>Calling this function is the same as calling <code>create(StoreId, PathPattern, Data)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#create/3">create/3</a>, <a href="#create/4">create/4</a>.</p>
  </section>
</section>
<section class="detail" id="create/3">

  <div class="detail-header">
    <a href="#create/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create(StoreId, PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> create(StoreId, PathPattern, Data) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Creates a tree node with the given payload.</p>Calling this function is the same as calling <code>create(StoreId, PathPattern, Data, #{})</code>.<p><em>See also: </em><a href="#create/4">create/4</a>.</p>
  </section>
</section>
<section class="detail" id="create/4">

  <div class="detail-header">
    <a href="#create/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">create(StoreId, PathPattern, Data, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> create(StoreId, PathPattern, Data, Options) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() | <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Creates a tree node with the given payload.</p><p>The behavior is the same as <a href="#put/4"><code>put/4</code></a> except that if the tree node already exists, an <code>{error, ?khepri_error(mismatching_node, Info)}</code> tuple is returned.</p>Internally, the <code>PathPattern</code> is modified to include an <code>#if_node_exists{exists = false}</code> condition on its last component.<p><em>See also: </em><a href="#put/4">put/4</a>, <a href="#update/4">update/4</a>, <a href="khepri.html#create/4">khepri:create/4</a>.</p>
  </section>
</section>
<section class="detail" id="delete/1">

  <div class="detail-header">
    <a href="#delete/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete(PathPattern) -> Ret
          when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Deletes the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>delete(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#delete/2">delete/2</a>, <a href="#delete/3">delete/3</a>.</p>
  </section>
</section>
<section class="detail" id="delete/2">

  <div class="detail-header">
    <a href="#delete/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete(StoreId, PathPattern) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>();
      (PathPattern, Options) -> Ret
          when
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Deletes the tree node pointed to by the given path pattern.</p>This function accepts the following two forms:<ul><li><code>delete(StoreId, PathPattern)</code>. Calling it is the same as calling <code>delete(StoreId, PathPattern, #{})</code>.</li><li><code>delete(PathPattern, Options)</code>. Calling it is the same as calling <code>delete(StoreId, PathPattern, Options)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).</li></ul><p><em>See also: </em><a href="#delete/3">delete/3</a>.</p>
  </section>
</section>
<section class="detail" id="delete/3">

  <div class="detail-header">
    <a href="#delete/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete(StoreId, PathPattern, Options) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Deletes the tree node pointed to by the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>The <code>PathPattern</code> must target a specific tree node. In other words, updating many nodes with the same payload is denied. That fact is checked before the tree node is looked up: so if a condition in the path could potentially match several nodes, an exception is raised, even though only one tree node would match at the time. If you want to delete multiple nodes at once, use <a href="#delete_many/3"><code>delete_many/3</code></a>.</p><p>The returned <code>{ok, NodeProps}</code> tuple contains a map with the properties and payload (if any) of the targeted tree node as they were before the delete. If the targeted tree node didn't exist, <code>NodeProps</code> will be an empty map.</p><p>When doing an asynchronous update, the <a href="khepri.html#wait_for_async_ret/1"><code>khepri:wait_for_async_ret/1</code></a> function can be used to receive the message from Ra.</p>Example:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Delete the tree node at `/:foo/:bar&#39;.</span><span class="w">
  </span><span class="p" data-group-id="4295659956-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295659956-2">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
         </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4295659956-2">}</span><span class="p" data-group-id="4295659956-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">delete</span><span class="p" data-group-id="4295659956-3">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4295659956-4">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="4295659956-4">]</span><span class="p" data-group-id="4295659956-3">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#delete_many/3">delete_many/3</a>, <a href="khepri.html#delete/3">khepri:delete/3</a>.</p>
  </section>
</section>
<section class="detail" id="delete_many/1">

  <div class="detail-header">
    <a href="#delete_many/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_many(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete_many(PathPattern) -> Ret
               when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Deletes all tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>delete_many(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#delete_many/2">delete_many/2</a>, <a href="#delete_many/3">delete_many/3</a>.</p>
  </section>
</section>
<section class="detail" id="delete_many/2">

  <div class="detail-header">
    <a href="#delete_many/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_many(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete_many(StoreId, PathPattern) -> Ret
               when
                   StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                   PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                   Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>();
           (PathPattern, Options) -> Ret
               when
                   PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                   Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
                   Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Deletes all tree nodes matching the given path pattern.</p>This function accepts the following two forms:<ul><li><code>delete_many(StoreId, PathPattern)</code>. Calling it is the same as calling <code>delete(StoreId, PathPattern, #{})</code>.</li><li><code>delete_many(PathPattern, Options)</code>. Calling it is the same as calling <code>delete(StoreId, PathPattern, Options)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).</li></ul><p><em>See also: </em><a href="#delete_many/3">delete_many/3</a>.</p>
  </section>
</section>
<section class="detail" id="delete_many/3">

  <div class="detail-header">
    <a href="#delete_many/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">delete_many(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> delete_many(StoreId, PathPattern, Options) -> Ret
               when
                   StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                   PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                   Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
                   Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Deletes all tree nodes matching the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>The returned <code>{ok, NodePropsMap}</code> tuple contains a map where keys correspond to the path to a deleted tree node. Each key then points to a map containing the properties and payload (if any) of that deleted tree node as they were before the delete.</p><p>When doing an asynchronous update, the <a href="khepri.html#wait_for_async_ret/1"><code>khepri:wait_for_async_ret/1</code></a> function can be used to receive the message from Ra.</p>Example:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Delete the tree node at `/:foo/:bar&#39;.</span><span class="w">
  </span><span class="p" data-group-id="1993021509-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1993021509-2">#{</span><span class="p" data-group-id="1993021509-3">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="1993021509-3">]</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="p" data-group-id="1993021509-4">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
                         </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="1993021509-4">}</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="1993021509-5">[</span><span class="ss">baz</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="1993021509-5">]</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="p" data-group-id="1993021509-6">#{</span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="1993021509-6">}</span><span class="p" data-group-id="1993021509-2">}</span><span class="p" data-group-id="1993021509-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">delete_many</span><span class="p" data-group-id="1993021509-7">(</span><span class="w">
                                                     </span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1993021509-8">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="1993021509-8">]</span><span class="p" data-group-id="1993021509-7">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#delete/3">delete/3</a>, <a href="khepri.html#delete/3">khepri:delete/3</a>.</p>
  </section>
</section>
<section class="detail" id="get/1">

  <div class="detail-header">
    <a href="#get/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get(PathPattern) -> Ret
       when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>get(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#get/2">get/2</a>, <a href="#get/3">get/3</a>.</p>
  </section>
</section>
<section class="detail" id="get/2">

  <div class="detail-header">
    <a href="#get/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get(StoreId, PathPattern) -> Ret
       when
           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>();
   (PathPattern, Options) -> Ret
       when
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Options :: <a href="khepri.html#t:query_options/0">khepri:query_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
           Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p>This function accepts the following two forms:<ul><li><code>get(StoreId, PathPattern)</code>. Calling it is the same as calling <code>get(StoreId, PathPattern, #{})</code>.</li><li><code>get(PathPattern, Options)</code>. Calling it is the same as calling <code>get(StoreId, PathPattern, Options)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).</li></ul><p><em>See also: </em><a href="#get/3">get/3</a>.</p>
  </section>
</section>
<section class="detail" id="get/3">

  <div class="detail-header">
    <a href="#get/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get(StoreId, PathPattern, Options) -> Ret
       when
           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Options :: <a href="khepri.html#t:query_options/0">khepri:query_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
           Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Returns the properties and payload of the tree node pointed to by the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>The <code>PathPattern</code> must target a specific tree node. In other words, updating many nodes with the same payload is denied. That fact is checked before the tree node is looked up: so if a condition in the path could potentially match several nodes, an exception is raised, even though only one tree node would match at the time. If you want to get multiple nodes at once, use <a href="#get_many/3"><code>get_many/3</code></a>.</p><p>The returned <code>{ok, NodeProps}</code> tuple contains a map with the properties and payload (if any) of the targeted tree node. If the tree node is not found, <code>{error, ?khepri_error(node_not_found, Info)}</code> is returned.</p>Example: query a tree node which holds the atom <code>value</code><pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Query the tree node at `/:foo/:bar&#39;.</span><span class="w">
  </span><span class="p" data-group-id="8497425673-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8497425673-2">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
         </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8497425673-2">}</span><span class="p" data-group-id="8497425673-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="8497425673-3">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8497425673-4">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="8497425673-4">]</span><span class="p" data-group-id="8497425673-3">)</span><span class="p">.</span></code></pre>Example: query an existing tree node with no payload<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Query the tree node at `/:no_payload&#39;.</span><span class="w">
  </span><span class="p" data-group-id="7619133625-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7619133625-2">#{</span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7619133625-2">}</span><span class="p" data-group-id="7619133625-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="7619133625-3">(</span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7619133625-4">[</span><span class="ss">no_payload</span><span class="p" data-group-id="7619133625-4">]</span><span class="p" data-group-id="7619133625-3">)</span><span class="p">.</span></code></pre>Example: query a non-existent tree node<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Query the tree node at `/:non_existent&#39;.</span><span class="w">
  </span><span class="p" data-group-id="4092883257-1">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="o">?</span><span class="nf">khepri_error</span><span class="p" data-group-id="4092883257-2">(</span><span class="ss">node_not_found</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="4092883257-2">)</span><span class="p" data-group-id="4092883257-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">get</span><span class="p" data-group-id="4092883257-3">(</span><span class="w">
                                                </span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4092883257-4">[</span><span class="ss">non_existent</span><span class="p" data-group-id="4092883257-4">]</span><span class="p" data-group-id="4092883257-3">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#get_many/3">get_many/3</a>, <a href="khepri.html#get/3">khepri:get/3</a>.</p>
  </section>
</section>
<section class="detail" id="get_many/1">

  <div class="detail-header">
    <a href="#get_many/1" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_many(PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_many(PathPattern) -> Ret
            when PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(), Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>get_many(StoreId, PathPattern)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#get_many/2">get_many/2</a>, <a href="#get_many/3">get_many/3</a>.</p>
  </section>
</section>
<section class="detail" id="get_many/2">

  <div class="detail-header">
    <a href="#get_many/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_many(StoreId, PathPattern)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_many(StoreId, PathPattern) -> Ret
            when
                StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>();
        (PathPattern, Options) -> Ret
            when
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Options :: <a href="khepri.html#t:query_options/0">khepri:query_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p>This function accepts the following two forms:<ul><li><code>get_many(StoreId, PathPattern)</code>. Calling it is the same as calling <code>get_many(StoreId, PathPattern, #{})</code>.</li><li><code>get_many(PathPattern, Options)</code>. Calling it is the same as calling <code>get_many(StoreId, PathPattern, Options)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).</li></ul><p><em>See also: </em><a href="#get_many/3">get_many/3</a>.</p>
  </section>
</section>
<section class="detail" id="get_many/3">

  <div class="detail-header">
    <a href="#get_many/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_many(StoreId, PathPattern, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> get_many(StoreId, PathPattern, Options) -> Ret
            when
                StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Options :: <a href="khepri.html#t:query_options/0">khepri:query_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Returns properties and payloads of all the tree nodes matching the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>The returned <code>{ok, NodePropsMap}</code> tuple contains a map where keys correspond to the path to a tree node matching the path pattern. Each key then points to a map containing the properties and payload (if any) of that matching tree node.</p>Example: query all nodes in the tree<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Get all nodes in the tree. The tree is:</span><span class="w">
  </span><span class="c1">%% &lt;root&gt;</span><span class="w">
  </span><span class="c1">%% `-- foo</span><span class="w">
  </span><span class="c1">%%     `-- bar = value</span><span class="w">
  </span><span class="p" data-group-id="6152972803-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6152972803-2">#{</span><span class="p" data-group-id="6152972803-3">[</span><span class="ss">foo</span><span class="p" data-group-id="6152972803-3">]</span><span class="w"> </span><span class="p">:=</span><span class="w">
         </span><span class="p" data-group-id="6152972803-4">#{</span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6152972803-4">}</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="6152972803-5">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="6152972803-5">]</span><span class="w"> </span><span class="p">:=</span><span class="w">
         </span><span class="p" data-group-id="6152972803-6">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
           </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6152972803-6">}</span><span class="p" data-group-id="6152972803-2">}</span><span class="p" data-group-id="6152972803-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">get_many</span><span class="p" data-group-id="6152972803-7">(</span><span class="w">
                                       </span><span class="n">StoreId</span><span class="p">,</span><span class="w">
                                       </span><span class="p" data-group-id="6152972803-8">[</span><span class="o">?</span><span class="n">KHEPRI_WILDCARD_STAR_STAR</span><span class="p" data-group-id="6152972803-8">]</span><span class="p" data-group-id="6152972803-7">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#get/3">get/3</a>, <a href="khepri.html#get_many/3">khepri:get_many/3</a>.</p>
  </section>
</section>
<section class="detail" id="put/2">

  <div class="detail-header">
    <a href="#put/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put(PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put(PathPattern, Data) -> Ret
       when
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
           Ret :: <a href="khepri.html#t:minimal_ret/0">khepri:minimal_ret</a>() | <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Sets the payload of the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>put(StoreId, PathPattern, Data)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#put/3">put/3</a>, <a href="#put/4">put/4</a>.</p>
  </section>
</section>
<section class="detail" id="put/3">

  <div class="detail-header">
    <a href="#put/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put(StoreId, PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put(StoreId, PathPattern, Data) -> Ret
       when
           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
           Ret :: <a href="khepri.html#t:minimal_ret/0">khepri:minimal_ret</a>() | <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Sets the payload of the tree node pointed to by the given path pattern.</p>Calling this function is the same as calling <code>put(StoreId, PathPattern, Data, #{})</code>.<p><em>See also: </em><a href="#put/4">put/4</a>.</p>
  </section>
</section>
<section class="detail" id="put/4">

  <div class="detail-header">
    <a href="#put/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put(StoreId, PathPattern, Data, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put(StoreId, PathPattern, Data, Options) -> Ret
       when
           StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
           PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
           Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
           Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() | <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
           Ret :: <a href="khepri.html#t:minimal_ret/0">khepri:minimal_ret</a>() | <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Sets the payload of the tree node pointed to by the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>The <code>PathPattern</code> must target a specific tree node. In other words, updating many nodes with the same payload is denied. That fact is checked before the tree node is looked up: so if a condition in the path could potentially match several nodes, an exception is raised, even though only one tree node would match at the time.</p><p>When using a simple path (i.e. without conditions), if the targeted tree node does not exist, it is created using the given payload. If the targeted tree node exists, it is updated with the given payload and its payload version is increased by one. Missing parent nodes are created on the way.</p><p>When using a path pattern, the behavior is the same. However if a condition in the path pattern is not met, an error is returned and the tree structure is not modified.</p><p>The returned <code>{ok, NodeProps}</code> tuple contains a map with the properties and payload (if any) of the targeted tree node: the payload was the one before the update, other properties like the payload version correspond to the updated node. If the targeted tree node didn't exist, <code>NodeProps</code> will be an empty map.</p>The payload must be one of the following form:<ul><li>An explicit absence of payload (<a href="khepri_payload.html#t:no_payload/0"><code>khepri_payload:no_payload()</code></a>), using the marker returned by <a href="khepri_payload.html#none/0"><code>khepri_payload:none/0</code></a>, meaning there will be no payload attached to the tree node and the existing payload will be discarded if any</li><li>An anonymous function; it will be considered a stored procedure and will be wrapped in a <a href="khepri_payload.html#t:sproc/0"><code>khepri_payload:sproc()</code></a> record</li><li>Any other term; it will be wrapped in a <a href="khepri_payload.html#t:data/0"><code>khepri_payload:data()</code></a> record</li></ul><p>It is possible to wrap the payload in its internal structure explicitly using the <a href="khepri_payload.html"><code>khepri_payload</code></a> module directly.</p><p>The <code>Options</code> map may specify command-level options; see <a href="khepri.html#t:command_options/0"><code>khepri:command_options()</code></a>, <a href="khepri.html#t:tree_options/0"><code>khepri:tree_options()</code></a> and <a href="khepri.html#t:put_options/0"><code>khepri:put_options()</code></a>.</p><p>When doing an asynchronous update, the <a href="khepri.html#wait_for_async_ret/1"><code>khepri:wait_for_async_ret/1</code></a> function can be used to receive the message from Ra.</p><p>The returned <code>{ok, NodeProps}</code> tuple contains a map with the properties and payload (if any) of the targeted tree node as they were before the put.</p>Example:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Insert a tree node at `/:foo/:bar&#39;, overwriting the previous value.</span><span class="w">
  </span><span class="p" data-group-id="9571944394-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9571944394-2">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
         </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9571944394-2">}</span><span class="p" data-group-id="9571944394-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">put</span><span class="p" data-group-id="9571944394-3">(</span><span class="w">
                                    </span><span class="n">StoreId</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9571944394-4">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="9571944394-4">]</span><span class="p">,</span><span class="w"> </span><span class="ss">new_value</span><span class="p" data-group-id="9571944394-3">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#compare_and_swap/5">compare_and_swap/5</a>, <a href="#create/4">create/4</a>, <a href="#update/4">update/4</a>, <a href="khepri.html#put/4">khepri:put/4</a>.</p>
  </section>
</section>
<section class="detail" id="put_many/2">

  <div class="detail-header">
    <a href="#put_many/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put_many(PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put_many(PathPattern, Data) -> Ret
            when
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Sets the payload of all the tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>put_many(StoreId, PathPattern, Data)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#put_many/3">put_many/3</a>, <a href="#put_many/4">put_many/4</a>.</p>
  </section>
</section>
<section class="detail" id="put_many/3">

  <div class="detail-header">
    <a href="#put_many/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put_many(StoreId, PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put_many(StoreId, PathPattern, Data) -> Ret
            when
                StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>().</pre>

      </div>

<p>Sets the payload of all the tree nodes matching the given path pattern.</p>Calling this function is the same as calling <code>put_many(StoreId, PathPattern, Data, #{})</code>.<p><em>See also: </em><a href="#put_many/4">put_many/4</a>.</p>
  </section>
</section>
<section class="detail" id="put_many/4">

  <div class="detail-header">
    <a href="#put_many/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">put_many(StoreId, PathPattern, Data, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> put_many(StoreId, PathPattern, Data, Options) -> Ret
            when
                StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
                PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
                Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
                Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() | <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
                Ret :: <a href="khepri_adv.html#t:many_results/0">khepri_adv:many_results</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Sets the payload of all the tree nodes matching the given path pattern.</p><p>The <code>PathPattern</code> can be provided as a native path pattern (a list of tree node names and conditions) or as a string. See <a href="khepri_path.html#from_string/1"><code>khepri_path:from_string/1</code></a>.</p><p>When using a simple path (i.e. without conditions), if the targeted tree node does not exist, it is created using the given payload. If the targeted tree node exists, it is updated with the given payload and its payload version is increased by one. Missing parent nodes are created on the way.</p><p>When using a path pattern, the behavior is the same. However if a condition in the path pattern is not met, an error is returned and the tree structure is not modified.</p><p>The returned <code>{ok, NodePropsMap}</code> tuple contains a map where keys correspond to the path to a tree node matching the path pattern. Each key then points to a map containing the properties and payload (if any) of the targeted tree node: the payload was the one before the update, other properties like the payload version correspond to the updated node.</p>The payload must be one of the following form:<ul><li>An explicit absence of payload (<a href="khepri_payload.html#t:no_payload/0"><code>khepri_payload:no_payload()</code></a>), using the marker returned by <a href="khepri_payload.html#none/0"><code>khepri_payload:none/0</code></a>, meaning there will be no payload attached to the tree node and the existing payload will be discarded if any</li><li>An anonymous function; it will be considered a stored procedure and will be wrapped in a <a href="khepri_payload.html#t:sproc/0"><code>khepri_payload:sproc()</code></a> record</li><li>Any other term; it will be wrapped in a <a href="khepri_payload.html#t:data/0"><code>khepri_payload:data()</code></a> record</li></ul><p>It is possible to wrap the payload in its internal structure explicitly using the <a href="khepri_payload.html"><code>khepri_payload</code></a> module directly.</p><p>The <code>Options</code> map may specify command-level options; see <a href="khepri.html#t:command_options/0"><code>khepri:command_options()</code></a>, <a href="khepri.html#t:tree_options/0"><code>khepri:tree_options()</code></a> and <a href="khepri.html#t:put_options/0"><code>khepri:put_options()</code></a>.</p><p>When doing an asynchronous update, the <a href="khepri.html#wait_for_async_ret/1"><code>khepri:wait_for_async_ret/1</code></a> function can be used to receive the message from Ra.</p>Example:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="c1">%% Set value of all tree nodes matching `/*/:bar&#39;, to `new_value&#39;.</span><span class="w">
  </span><span class="p" data-group-id="4543638680-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4543638680-2">#{</span><span class="p" data-group-id="4543638680-3">[</span><span class="ss">foo</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="4543638680-3">]</span><span class="w"> </span><span class="p">:=</span><span class="w">
         </span><span class="p" data-group-id="4543638680-4">#{</span><span class="ss">data</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="ss">value</span><span class="p">,</span><span class="w">
           </span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4543638680-4">}</span><span class="p">,</span><span class="w">
         </span><span class="p" data-group-id="4543638680-5">[</span><span class="ss">baz</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="4543638680-5">]</span><span class="w"> </span><span class="p">:=</span><span class="w">
         </span><span class="p" data-group-id="4543638680-6">#{</span><span class="ss">payload_version</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4543638680-6">}</span><span class="p" data-group-id="4543638680-2">}</span><span class="p" data-group-id="4543638680-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">khepri_adv</span><span class="p">:</span><span class="nf">put_many</span><span class="p" data-group-id="4543638680-7">(</span><span class="w">
                                       </span><span class="n">StoreId</span><span class="p">,</span><span class="w">
                                       </span><span class="p" data-group-id="4543638680-8">[</span><span class="o">?</span><span class="n">KHEPRI_WILDCARD_STAR</span><span class="p">,</span><span class="w"> </span><span class="ss">bar</span><span class="p" data-group-id="4543638680-8">]</span><span class="p">,</span><span class="w">
                                       </span><span class="ss">new_value</span><span class="p" data-group-id="4543638680-7">)</span><span class="p">.</span></code></pre><p><em>See also: </em><a href="#put/4">put/4</a>, <a href="khepri.html#put_many/4">khepri:put_many/4</a>.</p>
  </section>
</section>
<section class="detail" id="update/2">

  <div class="detail-header">
    <a href="#update/2" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update(PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> update(PathPattern, Data) -> Ret
          when
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload.</p>Calling this function is the same as calling <code>update(StoreId, PathPattern, Data)</code> with the default store ID (see <a href="khepri_cluster.html#get_default_store_id/0"><code>khepri_cluster:get_default_store_id/0</code></a>).<p><em>See also: </em><a href="#update/3">update/3</a>, <a href="#update/4">update/4</a>.</p>
  </section>
</section>
<section class="detail" id="update/3">

  <div class="detail-header">
    <a href="#update/3" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update(StoreId, PathPattern, Data)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> update(StoreId, PathPattern, Data) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload.</p>Calling this function is the same as calling <code>update(StoreId, PathPattern, Data, #{})</code>.<p><em>See also: </em><a href="#update/4">update/4</a>.</p>
  </section>
</section>
<section class="detail" id="update/4">

  <div class="detail-header">
    <a href="#update/4" class="detail-link" title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">update(StoreId, PathPattern, Data, Options)</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> update(StoreId, PathPattern, Data, Options) -> Ret
          when
              StoreId :: <a href="khepri.html#t:store_id/0">khepri:store_id</a>(),
              PathPattern :: <a href="khepri_path.html#t:pattern/0">khepri_path:pattern</a>(),
              Data :: <a href="khepri_payload.html#t:payload/0">khepri_payload:payload</a>() | <a href="khepri.html#t:data/0">khepri:data</a>() | fun(),
              Options :: <a href="khepri.html#t:command_options/0">khepri:command_options</a>() | <a href="khepri.html#t:tree_options/0">khepri:tree_options</a>() | <a href="khepri.html#t:put_options/0">khepri:put_options</a>(),
              Ret :: <a href="khepri_adv.html#t:single_result/0">khepri_adv:single_result</a>() | <a href="khepri_machine.html#t:async_ret/0">khepri_machine:async_ret</a>().</pre>

      </div>

<p>Updates an existing tree node with the given payload.</p><p>The behavior is the same as <a href="#put/4"><code>put/4</code></a> except that if the tree node already exists, an <code>{error, ?khepri_error(mismatching_node, Info)}</code> tuple is returned.</p>Internally, the <code>PathPattern</code> is modified to include an <code>#if_node_exists{exists = true}</code> condition on its last component.<p><em>See also: </em><a href="#create/4">create/4</a>, <a href="#put/4">put/4</a>, <a href="khepri.html#update/4">khepri:update/4</a>.</p>
  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/khepri/0.6.0" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/khepri/0.6.0">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/khepri/0.6.0/show/src/khepri_adv.erl">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="khepri.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.1) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
