<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.1">
    <meta name="project" content="khepri v0.6.0">

    <title>khepri_import_export â€” khepri v0.6.0</title>
    <link rel="stylesheet" href="dist/html-erlang-GK6YAAQS.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-IV5W3OL2.js"></script>
    <script src="dist/sidebar_items-40A8A753.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-XN2TSG4M.js"></script>


  </head>
  <body data-type="modules" class="page-behaviour">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="overview.html">
        <img src="assets/logo.svg" alt="khepri" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="overview.html" class="sidebar-projectName" translate="no">
khepri
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.6.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


  <span translate="no">khepri_import_export</span> <small>behaviour</small>
  <small class="app-vsn" translate="no">(khepri v0.6.0)</small>

</h1>


  <section id="moduledoc">
<p>Wrapper around Mnesia Backup &amp; Restore callback modules.</p><p>Khepri uses the same callback module as Mnesia to implement its import and export feature. The <a href="https://www.erlang.org/doc/apps/mnesia/mnesia_app_a">Mnesia Backup &amp; Restore API is described in the Mnesia documentation</a>.</p>Mnesia doesn't provide an Erlang behavior module to ease development. This module can be used as the behavior instead. For example:<pre><code class="makeup erlang" translate="no"><span class="w">  </span><span class="p">-</span><span class="na">module</span><span class="p" data-group-id="4681622210-1">(</span><span class="ss">my_export_module</span><span class="p" data-group-id="4681622210-1">)</span><span class="p">.</span><span class="w">
</span><span class="w">  </span><span class="p">-</span><span class="na">behavior</span><span class="p" data-group-id="4681622210-2">(</span><span class="ss">khepri_import_export</span><span class="p" data-group-id="4681622210-2">)</span><span class="p">.</span><span class="w">
</span><span class="w"> 
  </span><span class="p">-</span><span class="na">export</span><span class="p" data-group-id="4681622210-3">(</span><span class="p" data-group-id="4681622210-4">[</span><span class="ss">open_write</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
           </span><span class="ss">write</span><span class="p">/</span><span class="mi">2</span><span class="p">,</span><span class="w">
           </span><span class="ss">commit_write</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
           </span><span class="ss">abort_write</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
 
           </span><span class="ss">open_read</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
           </span><span class="ss">read</span><span class="p">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
           </span><span class="ss">close_read</span><span class="p">/</span><span class="mi">1</span><span class="p" data-group-id="4681622210-4">]</span><span class="p" data-group-id="4681622210-3">)</span><span class="p">.</span></code></pre><p>There are two sets of callback functions to implement: one used during export (or &quot;backup&quot; in Mnesia terms), one used during import (or &quot;restore&quot; in Mnesia terms).</p><h3 id="module-export-callback-api" class="section-heading">
  <a href="#module-export-callback-api" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">export-callback-api</p>
  </a>
  <a name="Export_callback_API">Export callback API</a>
</h3>
<ol><li><p><a href="#c:open_write/1"><code>open_write/1</code></a></p><p>This function is called at the beginning of an export. It is responsible for any initialization and must return an <code>{ok, ModulePriv}</code> tuple. <code>ModulePriv</code> is a private state passed to the following functions.</p></li><li><p><a href="#c:write/2"><code>write/2</code></a></p><p>This function is called for each subset of the items to export.</p><p><code>BackupItems</code> is a list of opaque Erlang terms. The callback module can't depend on the structure of these Erlang terms. Only the fact that it is a list is guarantied.</p><p>An empty list of <code>BackupItems</code> means this is the last call to <a href="#c:write/2"><code>write/2</code></a>. Otherwise, the way all items to export are split into several subsets and thus several calls to <a href="#c:write/2"><code>write/2</code></a> is undefined.</p><p>At the end of each call, the function must return <code>{ok, NewModulePriv}</code>. This new private state is passed to the subsequent calls.</p></li><li><p><a href="#c:commit_write/1"><code>commit_write/1</code></a></p><p>This function is called after successful calls to <a href="#c:write/2"><code>write/2</code></a>. It is responsible for doing any cleanup.</p><p>This function can return <code>ok</code> or <code>{ok, Ret}</code> if it wants to return some Erlang terms to the caller.</p></li><li><p><a href="#c:abort_write/1"><code>abort_write/1</code></a></p><p>This function is called after failed call to <a href="#c:write/2"><code>write/2</code></a>, or if reading from the Khepri store fails. It is responsible for doing any cleanup.</p><p>This function can return <code>ok</code> or <code>{ok, Ret}</code> if it wants to return some Erlang terms to the caller.</p></li></ol><h3 id="module-import-callback-api" class="section-heading">
  <a href="#module-import-callback-api" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">import-callback-api</p>
  </a>
  <a name="Import_callback_API">Import callback API</a>
</h3>
<ol><li><p><a href="#c:open_read/1"><code>open_read/1</code></a></p><p>This function is called at the beginning of an import. It is responsible for any initialization and must return an <code>{ok, ModulePriv}</code> tuple. <code>ModulePriv</code> is a private state passed to the following functions.</p></li><li><p><a href="#c:read/1"><code>read/1</code></a></p><p>This function is one or more times until there is nothing left to import.</p><p>The function must return <code>{ok, BackupItems, NewModulePriv}</code>. This new private state is passed to the subsequent calls.</p><p><code>BackupItems</code> is a list of opaque Erlang terms. The callback module can't depend on the structure of these Erlang terms. The backup items must be returned exactly as they were at the time of the export and in the same order.</p><p>An empty list of <code>BackupItems</code> means this is the last batch. <a href="#c:read/1"><code>read/1</code></a> won't be called anymore. <a href="#c:close_read/1"><code>close_read/1</code></a> will be called next instead.</p></li><li><p><code>c:close_read(ModulePriv)</code></p><p>This function is called after the last call to <a href="#c:read/1"><code>read/1</code></a>, successful or not, or if the actual import into the Khepri store fails. It is responsible for doing any cleanup.</p><p>This function can return <code>ok</code> or <code>{ok, Ret}</code> if it wants to return some Erlang terms to the caller.</p></li></ol><h3 id="module-available-callback-modules" class="section-heading">
  <a href="#module-available-callback-modules" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">available-callback-modules</p>
  </a>
  <a name="Available_callback_modules">Available callback modules</a>
</h3>
Khepri comes with <a href="khepri_export_erlang.html"><code>khepri_export_erlang</code></a>. This module offers to export Khepri tree nodes in a plain text file where backup items are formatted as Erlang terms.
  </section>


  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
      Summary
    </h1>
<div class="summary-types summary">
  <h2>
    <a href="#types">Types</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:backup_item/0" translate="no">backup_item/0</a>

      </div>

        <div class="summary-synopsis"><p>An opaque term passed in a list to <a href="#c:write/2"><code>write/2</code></a> and returned by <a href="#c:read/1"><code>read/1</code></a>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#t:module_priv/0" translate="no">module_priv/0</a>

      </div>

        <div class="summary-synopsis"><p>Private data passed to <a href="#c:open_write/1"><code>open_write/1</code></a> or <a href="#c:open_read/1"><code>open_read/1</code></a> initially.</p></div>

    </div>

</div>
<div class="summary-callbacks summary">
  <h2>
    <a href="#callbacks">Callbacks</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:abort_write/1" translate="no">abort_write/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:close_read/1" translate="no">close_read/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:commit_write/1" translate="no">commit_write/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:open_read/1" translate="no">open_read/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:open_write/1" translate="no">open_write/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:read/1" translate="no">read/1</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#c:write/2" translate="no">write/2</a>

      </div>

    </div>

</div>

  </section>


  <section id="types" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#types">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Types
    </h1>
    <div class="types-list">
<section class="detail" id="t:backup_item/0">

  <div class="detail-header">
    <a href="#t:backup_item/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">backup_item/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> backup_item() :: term().</pre>

      </div>

<p>An opaque term passed in a list to <a href="#c:write/2"><code>write/2</code></a> and returned by <a href="#c:read/1"><code>read/1</code></a>.</p>The callback module must not depend on the content of this term.
  </section>
</section>
<section class="detail" id="t:module_priv/0">

  <div class="detail-header">
    <a href="#t:module_priv/0" class="detail-link" title="Link to this type">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this type</span>
    </a>
    <h1 class="signature" translate="no">module_priv/0</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-type</span> module_priv() :: any().</pre>

      </div>

<p>Private data passed to <a href="#c:open_write/1"><code>open_write/1</code></a> or <a href="#c:open_read/1"><code>open_read/1</code></a> initially.</p>The actual term is specific to the callback module implementation. The callback can use this term however it wants. It is returned from most callback functions and passed to the next one.
  </section>
</section>

    </div>
  </section>

  <section id="callbacks" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#callbacks">
        <i class="ri-link-m" aria-hidden="true"></i>
        <span class="sr-only">Link to this section</span>
      </a>
Callbacks
    </h1>
    <div class="callbacks-list">
<section class="detail" id="c:abort_write/1">

  <div class="detail-header">
    <a href="#c:abort_write/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">abort_write/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> abort_write(ModulePriv) -> Ret
               when ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(), Ret :: ok | {error, any()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:close_read/1">

  <div class="detail-header">
    <a href="#c:close_read/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">close_read/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> close_read(ModulePriv) -> Ret
              when
                  ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
                  Ret :: ok | {ok, ModulePriv} | {error, any()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:commit_write/1">

  <div class="detail-header">
    <a href="#c:commit_write/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">commit_write/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> commit_write(ModulePriv) -> Ret
                when
                    ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
                    Ret :: ok | {ok, ModulePriv} | {error, any()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:open_read/1">

  <div class="detail-header">
    <a href="#c:open_read/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">open_read/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> open_read(ModulePriv) -> Ret
             when
                 ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
                 Ret :: {ok, ModulePriv} | {error, any()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:open_write/1">

  <div class="detail-header">
    <a href="#c:open_write/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">open_write/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> open_write(ModulePriv) -> Ret
              when
                  ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
                  Ret :: {ok, ModulePriv} | {error, any()}.</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:read/1">

  <div class="detail-header">
    <a href="#c:read/1" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">read/1</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> read(ModulePriv) -> Ret
        when
            ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
            Ret :: {ok, BackupItems, ModulePriv} | {error, any()},
            BackupItems :: [<a href="khepri_import_export.html#t:backup_item/0">khepri_import_export:backup_item</a>()].</pre>

      </div>


  </section>
</section>
<section class="detail" id="c:write/2">

  <div class="detail-header">
    <a href="#c:write/2" class="detail-link" title="Link to this callback">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this callback</span>
    </a>
    <h1 class="signature" translate="no">write/2</h1>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-callback</span> write(ModulePriv, BackupItems) -> Ret
         when
             ModulePriv :: <a href="khepri_import_export.html#t:module_priv/0">khepri_import_export:module_priv</a>(),
             BackupItems :: [<a href="khepri_import_export.html#t:backup_item/0">khepri_import_export:backup_item</a>()],
             Ret :: {ok, ModulePriv} | {error, any()}.</pre>

      </div>


  </section>
</section>

    </div>
  </section>

      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/khepri/0.6.0" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/khepri/0.6.0">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/khepri/0.6.0/show/src/khepri_import_export.erl">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="khepri.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.1) for the

            <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
